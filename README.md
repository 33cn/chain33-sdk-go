# chain33-sdk-go
chain33 sdk golang

## 版本
golang1.13 or latest

## 安装

```text
//开启mod功能
export GO111MODULE=on

//国内用户需要导入阿里云代理，用于下载依赖包
export GOPROXY=https://mirrors.aliyun.com/goproxy
```

## 使用

### RPC客户端
通过jclient调用rpc接口发送交易和查询交易
```go
client, err := client.NewJSONClient(name, server)
client.SendTransaction(signedTx) 
```

### 加解密
crypto包实现了常用的加解密算法，签名算法，sha256哈希算法，密码生成和区块链地址生成，可通过crypto包直接调用。
```go
// 国密签名
sig, _ := crypto.gm.SM2Sign(priv, msg,nil)

// 国密验签
result := crypto.gm.SM2Verify(pub, msg, nil, sig)
```

### 代理重加密
代理重加密密钥生成和本地加解密

### 存证接口
创建存证合约原始交易

### EVM合约
```go
// 合约代码：https://bty33.oss-cn-shanghai.aliyuncs.com/chain33Dev/BAAS/%E5%AD%98%E8%AF%81%E5%90%88%E7%BA%A6.zip
codes = "608060405234801561001057600080fd5b50600080546001600160a01b03191633179055610651806100326000396000f3fe608060405234801561001057600080fd5b506004361061004c5760003560e01c806313af4035146100515780637d24e37e14610079578063a8934d79146101a6578063b2bdfa7b146102c1575b600080fd5b6100776004803603602081101561006757600080fd5b50356001600160a01b03166102e5565b005b6100776004803603604081101561008f57600080fd5b8101906020810181356401000000008111156100aa57600080fd5b8201836020820111156100bc57600080fd5b803590602001918460018302840111640100000000831117156100de57600080fd5b91908080601f016020809104026020016040519081016040528093929190818152602001838380828437600092019190915250929594936020810193503591505064010000000081111561013157600080fd5b82018360208201111561014357600080fd5b8035906020019184600183028401116401000000008311171561016557600080fd5b91908080601f016020809104026020016040519081016040528093929190818152602001838380828437600092019190915250929550610350945050505050565b61024c600480360360208110156101bc57600080fd5b8101906020810181356401000000008111156101d757600080fd5b8201836020820111156101e957600080fd5b8035906020019184600183028401116401000000008311171561020b57600080fd5b91908080601f01602080910402602001604051908101604052809392919081815260200183838082843760009201919091525092955061045f945050505050565b6040805160208082528351818301528351919283929083019185019080838360005b8381101561028657818101518382015260200161026e565b50505050905090810190601f1680156102b35780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b6102c9610553565b604080516001600160a01b039092168252519081900360200190f35b6000546001600160a01b0316331461032e5760405162461bcd60e51b81526004018080602001828103825260268152602001806105f66026913960400191505060405180910390fd5b600080546001600160a01b0319166001600160a01b0392909216919091179055565b6000546001600160a01b031633146103995760405162461bcd60e51b81526004018080602001828103825260268152602001806105f66026913960400191505060405180910390fd5b8160008151116103e5576040805162461bcd60e51b815260206004820152601260248201527166696c65496420697320696e76616c69642160701b604482015290519081900360640190fd5b816001846040518082805190602001908083835b602083106104185780518252601f1990920191602091820191016103f9565b51815160209384036101000a600019018019909216911617905292019485525060405193849003810190932084516104599591949190910192509050610562565b50505050565b60606001826040518082805190602001908083835b602083106104935780518252601f199092019160209182019101610474565b518151600019602094850361010090810a820192831692199390931691909117909252949092019687526040805197889003820188208054601f60026001831615909802909501169590950492830182900482028801820190528187529294509250508301828280156105475780601f1061051c57610100808354040283529160200191610547565b820191906000526020600020905b81548152906001019060200180831161052a57829003601f168201915b50505050509050919050565b6000546001600160a01b031681565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106105a357805160ff19168380011785556105d0565b828001600101855582156105d0579182015b828111156105d05782518255916020019190600101906105b5565b506105dc9291506105e0565b5090565b5b808211156105dc57600081556001016105e156fe6f6e6c7920617574686f72697a6564206f776e65722063616e2073746f72652066696c65732ea264697066735822122031f48e60df7c860caf840a264a2bf73faebcde84c840a53808e210c386ebde7a64736f6c634300060c0033"
abi   = "[{\"inputs\":[],\"name\":\"_owner\",\"outputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"string\",\"name\":\"fileId\",\"type\":\"string\"}],\"name\":\"getFileById\",\"outputs\":[{\"internalType\":\"string\",\"name\":\"\",\"type\":\"string\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"string\",\"name\":\"fileId\",\"type\":\"string\"},{\"internalType\":\"string\",\"name\":\"content\",\"type\":\"string\"}],\"name\":\"setFileStockById\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"owner\",\"type\":\"address\"}],\"name\":\"setOwner\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"}]"
)
```

- 合约部署
```go
code, err := types.FromHex(codes)
tx, err := CreateEvmContract(code, "", "evm-sdk-test", privateKey, paraName, 1e6)
signTx := types.ToHexPrefix(types.Encode(tx))
client.SendTransaction(signedTx)

contractAddress := crypto.GetExecAddress(address + strings.TrimPrefix(txhash, "0x")) 
```

- 合约调用
```go
param = fmt.Sprintf("setFileStockById(%s,%s)", fileId, content)
setFileStockById, err := EncodeParameter(abi, param)
tx, err = CallEvmContract(setFileStockById, "", 0, contractAddress, privateKey, paraName, 1e6)
signTx := types.ToHexPrefix(types.Encode(tx))
client.SendTransaction(signedTx) 
```

- 合约查询
```go
param = fmt.Sprintf("getFileById(%s)", fileId)
QueryContract(server, contractAddress, abi, param, contractAddress)
```

## 接口文档
[chain33-sdk-go API](./接口文档.md)